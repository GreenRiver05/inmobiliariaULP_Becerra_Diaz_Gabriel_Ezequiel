@model inmobiliariaBD.Models.PagoDetalleViewModel
@{
    ViewData["Title"] = "Detalle de Pago";
}

<h2 class="text-light mb-4 text-center">💰 Detalle del Pago</h2>

<div class="d-flex flex-row flex-nowrap overflow-auto gap-3 mb-4">
    <!-- Pago -->
    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-success text-center">Pago</div>
        <div class="card-body p-2">
            <p><strong>Registro N°:</strong> @Model.Pago.Id</p>
            <p><strong>N° Pago:</strong> @Model.Pago.NumeroPago</p>
            <p><strong>Monto:</strong> $@Model.Pago.Monto</p>
            <p><strong>Fecha:</strong> @Model.Pago.Fecha.ToString("dd/MM/yyyy")</p>
            <p><strong>Detalle:</strong> @Model.Pago.Detalle</p>
            <p><strong>Tipo:</strong> @Model.Pago.Tipo</p>
            <p><strong>Estado:</strong>
                <span
                    class="badge @(Model.Pago.Estado == "Pago" ? "bg-success" : Model.Pago.Estado == "Pendiente" ? "bg-warning text-dark" : "bg-danger")">
                    @Model.Pago.Estado
                </span>
            </p>
        </div>
    </div>

    <div class="d-flex flex-column gap-3" style="min-width: 260px;">

        <div class="card bg-dark text-white border-secondary">
            <div class="card-header bg-info text-center">Contrato</div>
            <div class="card-body p-2">
                <p><strong>Contrato N°:</strong> @Model.Contrato.Id</p>
                <p><strong>Inicio:</strong> @Model.Contrato.Desde.ToString("dd/MM/yyyy")</p>
                <p><strong>Fin:</strong> @Model.Contrato.Hasta.ToString("dd/MM/yyyy")</p>
            </div>
        </div>


        <div class="card bg-dark text-white border-secondary">
            <div class="card-header bg-secondary text-center">Inmueble</div>
            <div class="card-body p-2">
                <p><strong>Dirección:</strong> @Model.Inmueble.Direccion</p>
                <p><strong>Localidad:</strong> @Model.Inmueble.Localidad</p>
            </div>
        </div>
    </div>

    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-info text-center">Inquilino</div>
        <div class="card-body p-2">
            <p><strong>Nombre:</strong> @Model.Inquilino.Persona.Nombre</p>
            <p><strong>Apellido:</strong> @Model.Inquilino.Persona.Apellido</p>
            <p><strong>DNI:</strong> @Model.Inquilino.Dni</p>
            <p><strong>Dirección:</strong> @Model.Inquilino.Persona.Direccion</p>
            <p><strong>Localidad:</strong> @Model.Inquilino.Persona.Localidad</p>
            <p><strong>Teléfono:</strong> @Model.Inquilino.Persona.Telefono</p>
            <p><strong>Correo:</strong> @Model.Inquilino.Persona.Correo</p>
        </div>
    </div>


    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-primary text-center">Propietario</div>
        <div class="card-body p-2">
            <p><strong>Nombre:</strong> @Model.Propietario.Persona.Nombre</p>
            <p><strong>Apellido:</strong> @Model.Propietario.Persona.Apellido</p>
            <p><strong>DNI:</strong> @Model.Propietario.Dni</p>
            <p><strong>Dirección:</strong> @Model.Propietario.Persona.Direccion</p>
            <p><strong>Localidad:</strong> @Model.Propietario.Persona.Localidad</p>
            <p><strong>Teléfono:</strong> @Model.Propietario.Persona.Telefono</p>
            <p><strong>Correo:</strong> @Model.Propietario.Persona.Correo</p>
        </div>
    </div>



</div>


@if (User.IsInRole("Admin"))
{
    <h4 class="text-light mt-4 mb-3">
        <i class="fa-solid fa-user-secret"></i> Auditoría del pago
    </h4>

    <div class="table-responsive">
        <table class="table table-dark table-bordered table-hover tabla-index">
            <thead class="bg-gradient bg-secondary text-light text-center">
                <tr>
                    <th style="width: 25%">Acción realizada</th>
                    <th style="width: 35%">Usuario responsable</th>
                    <th style="width: 15%">DNI</th>
                    <th style="width: 20%">Fecha</th>
                    <th style="width: 20%">Hora</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var log in Model.Auditoria.OrderByDescending(l => l.Fecha))
                {
                    <tr>
                        <td>@log.Accion</td>
                        <td>@($"{log.Usuario.Persona.Nombre} {log.Usuario.Persona.Apellido}")</td>
                        <td>@log.Usuario.Persona.Dni</td>
                        <td>@log.Fecha.ToString("dd/MM/yyyy")</td>
                        <td>@log.Fecha.ToString("HH:mm:ss")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}


<div class="d-flex justify-content-center mt-4">
    @if (ViewBag.VolverAContrato != null && (bool)ViewBag.VolverAContrato)
    {
        <a asp-controller="Contrato" asp-action="Detalles" asp-route-id="@Model.Contrato.Id"
            class="btn btn-outline-secondary mt-4">
            <i class="fa-solid fa-arrow-left"></i> Volver al contrato
        </a>
    }
    else
    {
        <a asp-action="Index" class="btn btn-outline-secondary mt-4">
            <i class="fa-solid fa-arrow-left"></i> Volver al listado
        </a>
    }
</div>
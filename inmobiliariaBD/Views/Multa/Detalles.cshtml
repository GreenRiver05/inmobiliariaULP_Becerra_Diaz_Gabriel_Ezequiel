@model inmobiliariaBD.Models.MultaDetalleViewModel

@{
    ViewData["Title"] = "Detalle de Multa";
}

<h2 class="text-light mb-4 text-center">⚠️ Detalle de la Multa</h2>

<div class="d-flex flex-row flex-nowrap overflow-auto gap-3 mb-4">

    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-danger text-center">Multa</div>
        <div class="card-body p-2">
            <p><strong>Registro N°:</strong> @Model.Multa.Id</p>
            <p><strong>Contrato:</strong> #@Model.Multa.ContratoId</p>
            <p><strong>Monto:</strong> $@Model.Multa.Monto</p>
            <p><strong>Fecha de aviso:</strong> @Model.Multa.FechaAviso.ToString("dd/MM/yyyy")</p>
            <p><strong>Fecha de terminación:</strong> @Model.Multa.FechaTerminacion.ToString("dd/MM/yyyy")</p>

        </div>
    </div>

    <div class="d-flex flex-column gap-3" style="min-width: 260px;">
        <div class="card bg-dark text-white border-secondary">
            <div class="card-header bg-info text-center">Contrato</div>
            <div class="card-body p-2">
                <p><strong>Registro N°:</strong> @Model.Contrato.Id</p>
                <p><strong>Inicio:</strong> @Model.Contrato.Desde.ToString("dd/MM/yyyy")</p>
                <p><strong>Fin:</strong> @Model.Contrato.Hasta.ToString("dd/MM/yyyy")</p>
            </div>
        </div>

        <div class="card bg-dark text-white border-secondary">
            <div class="card-header bg-secondary text-center">Inmueble</div>
            <div class="card-body p-2">
                <p><strong>Dirección:</strong> @Model.Inmueble.Direccion</p>
                <p><strong>Localidad:</strong> @Model.Inmueble.Localidad</p>
            </div>
        </div>
    </div>

    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-info text-center">Inquilino</div>
        <div class="card-body p-2">
            <p><strong>Nombre:</strong> @Model.Inquilino.Persona.Nombre</p>
            <p><strong>Apellido:</strong> @Model.Inquilino.Persona.Apellido</p>
            <p><strong>DNI:</strong> @Model.Inquilino.Dni</p>
            <p><strong>Dirección:</strong> @Model.Inquilino.Persona.Direccion</p>
            <p><strong>Localidad:</strong> @Model.Inquilino.Persona.Localidad</p>
            <p><strong>Teléfono:</strong> @Model.Inquilino.Persona.Telefono</p>
            <p><strong>Correo:</strong> @Model.Inquilino.Persona.Correo</p>
        </div>
    </div>

    <div class="card bg-dark text-white border-secondary" style="min-width: 260px;">
        <div class="card-header bg-primary text-center">Propietario</div>
        <div class="card-body p-2">
            <p><strong>Nombre:</strong> @Model.Propietario.Persona.Nombre</p>
            <p><strong>Apellido:</strong> @Model.Propietario.Persona.Apellido</p>
            <p><strong>DNI:</strong> @Model.Propietario.Dni</p>
            <p><strong>Dirección:</strong> @Model.Propietario.Persona.Direccion</p>
            <p><strong>Localidad:</strong> @Model.Propietario.Persona.Localidad</p>
            <p><strong>Teléfono:</strong> @Model.Propietario.Persona.Telefono</p>
            <p><strong>Correo:</strong> @Model.Propietario.Persona.Correo</p>
        </div>
    </div>
</div>


@if (User.IsInRole("Admin"))
{
    <h4 class="text-light mt-5 mb-3">
        <i class="fa-solid fa-user-secret"></i> Auditoría de la multa
    </h4>

    <div class="table-responsive">
        <table class="table table-dark table-bordered table-hover tabla-index">
            <thead class="bg-gradient bg-secondary text-light text-center">
                <tr>
                    <th style="width: 25%">Acción realizada</th>
                    <th style="width: 35%">Usuario responsable</th>
                    <th style="width: 15%">DNI</th>
                    <th style="width: 20%">Fecha</th>
                    <th style="width: 20%">Hora</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var log in Model.Auditoria.OrderByDescending(l => l.Fecha))
                {
                    <tr>
                        <td>@log.Accion</td>
                        <td>@($"{log.Usuario.Persona.Nombre} {log.Usuario.Persona.Apellido}")</td>
                        <td>@log.Usuario.Persona.Dni</td>
                        <td>@log.Fecha.ToString("dd/MM/yyyy")</td>
                        <td>@log.Fecha.ToString("HH:mm:ss")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}


<div class="d-flex justify-content-center mt-4">

    @if (ViewBag.VolverAContrato != null && (bool)ViewBag.VolverAContrato)
    {
        <a asp-controller="Contrato" asp-action="Detalles" asp-route-id="@Model.Contrato.Id"
            class="btn btn-outline-secondary me-2">
            <i class="fa-solid fa-arrow-left"></i> Volver al contrato
        </a>
    }
    else
    {
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left"></i> Volver al listado
        </a>
    }

</div>